### 问题:
我们有一个私有化部署的系统，但是用了公共的数据库数据，而且用了一段时间了，  
而现在为了安全需要删除很多其它公司的数据，我们只要涉及不同公司的数据表，  
都有一个字段company_id，因此，现在需要查找出所有带company_id的表，  
并且删除不属于私有用户的数据。
### 解决办法:
1. 查找所有需要处理的表  
select table_name from information_schema.columns where table_schema = '数据库名' and column_name = 'company_id';
2. 把表名处理成需要执行的sql语句（使用vim操作）
* 先使用Ctrl + v进入列模式，在所有表名前统一添加delete from
* 之后使用vim的记录操作重放功能，先使用qa进入记录模式，  
跳转到第一行的结尾添加 where company_id not in (1, 3, 4);  
并且跳转到第二行的结尾，并且按q来退出记录。  
此时开始重放刚才的操作，先要看好需要重放多少次。比如我有100行，就需要重放100次。  
执行的操作是：先按100，之后@a，就开始重放操作，所有行后面都会增加where语句。
3. 现在需要将拼接好的sql去执行，此时需要有一点要注意，因为很多表中都存在外键，  
而我们的表很可能是按拼音来排序的，有外键的情况下，数据是要根据实际外键情况来删除的。  
但是我们这里是要删除所有数据，就先将外键检验去掉```SET FOREIGN_KEY_CHECKS=0;```,  
然后执行我们的sql，执行完成后，再将外键检验打开```SET FOREIGN_KEY_CHECKS=1;```。